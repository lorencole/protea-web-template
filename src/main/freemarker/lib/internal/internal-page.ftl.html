<#macro pageScript>

	<script>
 	loadPageScript(function() {
 		<#nested>
 	});
 	</script>

</#macro>

<#macro page title icon="" subtitle="" script="">
		
	<script>
	
		window.page = null;
		document.title = '${title}';
		
		function loadPageScript(fxn, alwaysFxn) {
			var currentPageGenerated = '${.now}';
			var pageObj = app.pages['${pp.sourceFileName}'];
			if (pageObj && pageObj.generated && pageObj.generated == currentPageGenerated) {
				window.page = pageObj;
				alwaysFxn && alwaysFxn();
				return;
			}
			app.pages['${pp.sourceFileName}'] = {};
			app.pages['${pp.sourceFileName}'].generated = currentPageGenerated;
			window.page = app.pages['${pp.sourceFileName}'];
			fxn && fxn();
			alwaysFxn && alwaysFxn();
		}
	
	</script>

	<@pageHeader title="${title}" icon="${icon}" subtitle="${subtitle}"></@pageHeader>

	<#nested>
	
	<@pageFooter></@pageFooter>

	<script>
	<#if script?has_content>
	pageLocalScript = function() { ${script} };
	<#else>
	pageLocalScript = function() { if (page && page.onload) { page.onload(); } };
	</#if>
	</script>

</#macro>

